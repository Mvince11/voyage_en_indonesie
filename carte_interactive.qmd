---
title: "Carte Intercative"
lang: fr
back-to-top-navigation: false
format:
  dashboard:
    orientation: columns
    #page-layout: full
    
resources:
  - Images/icons/*.svg
  - layers/data_s12a.json
    
include-in-header:
  text: |
    <script src="js/maplibre.js"></script>
    <link href="js/maplibre.css" rel="stylesheet">
    <script src="js/jquery_3.5.min.js" type="text/javascript"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="js/photon-geocoder-autocomplete.min.css" type="text/css">
    <script src="js/photon-geocoder-autocomplete.min.js" type="text/javascript"></script>
---

<link href="https://cdn.jsdelivr.net/npm/maplibre-gl@2.4.0/dist/maplibre-gl.min.css" rel="stylesheet">

# Cartographie {height="100%" width="100%"}

```{ojs}
//| echo: false
//| padding: 0px
//| expandable: false
//| fill: true
maplibregl = await require("https://cdn.jsdelivr.net/npm/maplibre-gl@2.4.0/dist/maplibre-gl.min.js")

map = {
  const container = html`<div style="height: 690px; width: 100%"></div>`;
  yield container;

  const map = new maplibregl.Map({
    container: container,
    style: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
    zoom: 11
  });

  // Centrage imm√©diat (safe √† faire avant le load)
  map.fitBounds(
    [[94.0, -11.0], [141.0, 6.5]],
    { padding: 20, duration: 0, linear: true }
  );

  map.on('load', () => {
    // üîÅ Ajout des sources IGN (uniquement apr√®s chargement du style)
    const sourcePlanIGN = {
      style: 'normal',
      format: 'image/png',
      layer: 'GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2'
    };

    const sourceOrtho = {
      style: 'normal',
      format: 'image/jpeg',
      layer: 'HR.ORTHOIMAGERY.ORTHOPHOTOS'
    };

    map.addSource('raster-planign', {
      type: 'raster',
      tiles: [
        `https://data.geopf.fr/wmts?SERVICE=WMTS&style=${sourcePlanIGN.style}&VERSION=1.0.0&REQUEST=GetTile&format=${sourcePlanIGN.format}&layer=${sourcePlanIGN.layer}&tilematrixset=PM&TileMatrix={z}&TileCol={x}&TileRow={y}`
      ],
      tileSize: 256,
      attribution: '¬© <a href="https://www.ign.fr/">IGN</a>',
      minzoom: 0,
      maxzoom: 22
    });

    map.addSource('raster-ortho', {
      type: 'raster',
      tiles: [
      'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
    ],
    tileSize: 256,
    attribution:
      'Tiles ¬© Esri ‚Äî Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community',
      minzoom: 0,
      maxzoom: 22
    });
    
    map.addSource('labels', {
    type: 'raster',
    tiles: [
      'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}'
    ],
    tileSize: 256,
    attribution: '¬© Esri'
  });

    map.addLayer({
      id: 'planIGN',
      type: 'raster',
      source: 'raster-planign',
      layout: { visibility: 'none' }
    });

    map.addLayer({
      id: 'orthoIGN',
      type: 'raster',
      source: 'raster-ortho',
      layout: { visibility: 'visible' }
    });
    
    map.addLayer({
    id: 'labels',
    type: 'raster',
    source: 'labels',
    layout: { visibility: 'visible' }
  });

    // ‚úÖ Menu de bascule de fond
    const toggleStyle = (useOrtho) => {
      map.setLayoutProperty('orthoIGN', 'visibility', useOrtho ? 'visible' : 'none');
      map.setLayoutProperty('planIGN', 'visibility', useOrtho ? 'none' : 'visible');
      map.setLayoutProperty('labels', 'visibility', useOrtho ? 'visible' : 'none');
    };

    const mapMenuDiv = document.createElement('div');
    mapMenuDiv.classList.add('mapFondDePlan');
    mapMenuDiv.style.position = 'absolute';
    mapMenuDiv.style.zIndex = '1000';
    mapMenuDiv.innerHTML = `
    <strong>Fond de plan :</strong>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="orthoCheckbox" checked>
      <label class="form-check-label" for="orthoCheckbox">Photos a√©riennes</label>
    </div>
  `;

    map.getContainer().appendChild(mapMenuDiv);

    document.getElementById('orthoCheckbox').addEventListener('change', function (e) {
      e.preventDefault();
      e.stopPropagation();
      toggleStyle(this.checked);
    });
    
    // üîß Cr√©ation d‚Äôun √©l√©ment HTML pour le marqueur personnalis√©
    const el = document.createElement('div');
    el.className = 'custom-marker';
    el.style.width = '48px';
    el.style.height = '48px';
    el.style.borderRadius = '50%';
    el.style.overflow = 'hidden';
    el.style.border = '2px solid white';
    el.style.boxShadow = '0 0 6px rgba(0,0,0,0.6)';
    el.style.backgroundColor = '#ccc';

    // Cr√©ation de l'image √† l'int√©rieur du div
    const img = document.createElement('img');
    img.src = './images/aeroport_jakarta.png';
    img.style.width = '100%';
    img.style.height = '100%';
    img.style.objectFit = 'cover';

    el.appendChild(img); // Ajoute l‚Äôimage dans le marqueur
    
    new maplibregl.Marker({ element: el }) // tu peux personnaliser la couleur ici
  .setLngLat([106.7923764, -6.1797874]) // coordonn√©es de Jakarta : [longitude, latitude]
  .setPopup(new maplibregl.Popup({ offset: 25 }).setText('Jakarta a√©roport')) // optionnel : popup
  .addTo(map);

  });

  // Ces contr√¥les peuvent √™tre ajout√©s √† tout moment
  map.addControl(new maplibregl.FullscreenControl(), 'top-right');
  map.addControl(new maplibregl.NavigationControl({ visualizePitch: true }), 'top-left');
  map.addControl(new maplibregl.ScaleControl({ maxWidth: 80, unit: 'metric' }));
}

```

#  {.sidebar}

```{=html}
<div style="color:#dc7633; text-align:inherit !important; font-size:1.3em; font-weight:bold; font-family: calibri;margin-bottom:10%;">
 Nombre de personnes occupant des b√¢timents (logements et activit√©s) de plain-pied fortement inondables (plus de 1,5 m d‚Äôeau) 
 </div>

<div style="text-align:inherit !important; font-size:1.1em; font-family: calibri;margin-bottom:10%;"> Le niveau des eaux peut monter relativement vite pour pi√©ger des personnes dans des locaux ne disposant pas d‚Äôun acc√®s vers un √©tage refuge. Dans les locaux o√π la hauteur d‚Äôeau peut √™tre importante (sup√©rieure √† 1,5m), cela repr√©sente un danger. </div>


<a href=https://fiches.eptb-vienne.fr/ind_12a.pdf target=_blank><i class="fa fa-exclamation-circle"></i> T√©l√©charger la fiche indicateur et la carte</a> 


<div style="width: auto; padding:5px; border: 1px solid #A0A0A0; border-radius:15px; text-align: center !important; background: #F2F2F2; font-size:1.1em;margin-top:10%;">
La zone inondable correspond √† l'al√©a centennal construit √† partir des donn√©es disponibles et notamment r√©glementaires mais en aucun cas ne se substitue aux documents r√©glementaires en vigueur.
</div>
```
