---
title: "Carte Intercative"
lang: fr
back-to-top-navigation: false
format:
  dashboard:
    orientation: columns
    #page-layout: full
    sidebar-width: 35%
    expandable: true
    
resources:
  - Images/icons/*.svg
  - layers/data_s12a.json
    
include-in-header:
  text: |
    <script src="js/maplibre.js"></script>
    <link href="js/maplibre.css" rel="stylesheet">
    <script src="js/jquery_3.5.min.js" type="text/javascript"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="js/photon-geocoder-autocomplete.min.css" type="text/css">
    <script src="js/photon-geocoder-autocomplete.min.js" type="text/javascript"></script>
---

<link href="https://cdn.jsdelivr.net/npm/maplibre-gl@2.4.0/dist/maplibre-gl.min.css" rel="stylesheet">

# Cartographie

## Column {width="80%"}

```{ojs}
//| echo: false
//| padding: 0px
//| expandable: false
//| fill: true
maplibregl = await require("https://cdn.jsdelivr.net/npm/maplibre-gl@2.4.0/dist/maplibre-gl.min.js")

map = {
  const container = html` <div style="width: 100%; display: flex;">
    <div id="map-container" style="flex: 2; height: 678px;"></div>
  </div>`;
  yield container;

  const map = new maplibregl.Map({
    container: container.querySelector("#map-container"),
    style: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
    zoom: 11
  });

  // Centrage imm√©diat (safe √† faire avant le load)
  map.fitBounds([
    [104.5, -5.5],   // coin nord-ouest : un peu √† l'ouest et au nord de Serang
    [121.0, -9.2]],
    { padding: 20, duration: 0, linear: true }
  );

  map.on('load', () => {
    // üîÅ Ajout des sources IGN (uniquement apr√®s chargement du style)
    const sourcePlanIGN = {
      style: 'normal',
      format: 'image/png',
      layer: 'GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2'
    };

    const sourceOrtho = {
      style: 'normal',
      format: 'image/jpeg',
      layer: 'HR.ORTHOIMAGERY.ORTHOPHOTOS'
    };

    map.addSource('raster-planign', {
      type: 'raster',
      tiles: [
        `https://data.geopf.fr/wmts?SERVICE=WMTS&style=${sourcePlanIGN.style}&VERSION=1.0.0&REQUEST=GetTile&format=${sourcePlanIGN.format}&layer=${sourcePlanIGN.layer}&tilematrixset=PM&TileMatrix={z}&TileCol={x}&TileRow={y}`
      ],
      tileSize: 256,
      attribution: '¬© <a href="https://www.ign.fr/">IGN</a>',
      minzoom: 0,
      maxzoom: 22
    });

    map.addSource('raster-ortho', {
      type: 'raster',
      tiles: [
      'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
    ],
    tileSize: 256,
    attribution:
      'Tiles ¬© Esri ‚Äî Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community',
      minzoom: 0,
      maxzoom: 22
    });
    
    map.addSource('labels', {
    type: 'raster',
    tiles: [
      'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}'
    ],
    tileSize: 256,
    attribution: '¬© Esri'
  });

    map.addLayer({
      id: 'planIGN',
      type: 'raster',
      source: 'raster-planign',
      layout: { visibility: 'none' }
    });

    map.addLayer({
      id: 'orthoIGN',
      type: 'raster',
      source: 'raster-ortho',
      layout: { visibility: 'visible' }
    });
    
    map.addLayer({
    id: 'labels',
    type: 'raster',
    source: 'labels',
    layout: { visibility: 'visible' }
  });

    // ‚úÖ Menu de bascule de fond
    const toggleStyle = (useOrtho) => {
      map.setLayoutProperty('orthoIGN', 'visibility', useOrtho ? 'visible' : 'none');
      map.setLayoutProperty('planIGN', 'visibility', useOrtho ? 'none' : 'visible');
      map.setLayoutProperty('labels', 'visibility', useOrtho ? 'visible' : 'none');
    };

    const mapMenuDiv = document.createElement('div');
    mapMenuDiv.classList.add('mapFondDePlan');
    mapMenuDiv.style.position = 'absolute';
    mapMenuDiv.style.zIndex = '1000';
    mapMenuDiv.innerHTML = `
    <strong>Fond de plan :</strong>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="orthoCheckbox" checked>
      <label class="form-check-label" for="orthoCheckbox">Photos a√©riennes</label>
    </div>
  `;

    map.getContainer().appendChild(mapMenuDiv);

    document.getElementById('orthoCheckbox').addEventListener('change', function (e) {
      e.preventDefault();
      e.stopPropagation();
      toggleStyle(this.checked);
    });
    
      const markersData = [
      {
        coords: [106.7923764, -6.1797874], // Jakarta
        title: 'Jakarta',
        image: 'images/aeroport_jakarta.png',
        description: 'Capitale de l‚ÄôIndon√©sie.',
        arrivee: 'Arriv√©e le 28/06/2025',
        depart: null,
        commentaire:"Avant d'arriver √† CGK (a√©roport de Jakarta), escale √† Singapour. 13h de vol apr√®s un r√©veil     matinal pour rallier Toulouse √† Barcelone. A peine arriv√©e √† Jakarta, d√©part pour Bandung en mini van √©quip√© d'un karaok√© que l'on n'a pas utilis√© durant le trajet. Tout le monde dort.",
        photo1:  'images/jakarta_01.jpg',
        photo2:  'images/jakarta_02.jpg',
        photo3:  'images/jakarta_03.jpg'
      },
      {
        coords: [107.609810, -6.914744], // Bandung
        title: 'Bandung',
        image: 'images/bandung_popup.jpg',
        description: 'Ville universitaire entour√©e de volcans.',
        arrivee: 'Arriv√©e le 28/06/2025',
        depart: 'D√©part le 30/06/2025',
        commentaire:"Apr√®s une bonne nuit de sommeil, d√©part pour le Kawah puthi et son crat√®re d'acide. Impressionnant et piquant. Sur la route, de belle plantation de th√© et des cultures de fraises. L'apr√®s-midi un autre volcan. Le Rengganis et ses sources d'eau chaude. Pour y acc√®der, travers√©e sur un pont suspendu qui a donn√© des sueurs froides √† certains ! A Rengganis cette fois-ci, forte odeur de soufre. Retour de nuit et dans les bouchons. Comme √† l'aller d'ailleurs. Difficile de se frayer un chemin entre les scooters et les voitures. ",
        photo1:  'images/lac_acide_01.jpg',
        photo2:  'images/pont_lac_acide.jpg',
        photo3:  'images/champs_the_01.jpg',
        photo4:  'images/champs_the_02.jpg',
        photo5:  'images/champs_the_03.jpg',
        photo6:  'images/eau_chaude_01.jpg',
        photo7:  'images/eau_chaude_02.jpg'
      },
      {
        coords: [110.3695, -7.7956], // Yogyakarta
        title: 'Yogyakarta',
        image: 'images/Yogyakarta.jpg',
        description: "La ville est connue comme centre de l'art classique javanais et de la culture traditionnelle.",
        arrivee: 'Arriv√©e le 30/06/2025',
        depart: 'D√©part le 03/07/2025',
        commentaire:"Avant d'arriver √† CGK (a√©roport de Jakarta), escale √† Singapour. 13h de vol apr√®s un r√©veil     matinal pour rallier Toulouse √† Barcelone. A peine arriv√©e √† Jakarta, d√©part pour Bandung en mini van √©quip√© d'un karaok√© que l'on n'a pas utilis√© durant le trajet. Tout le monde dort.",
        photo1:  'images/jakarta_01.jpg',
        photo2:  'images/jakarta_02.jpg',
        photo3:  'images/jakarta_03.jpg'
      }
    ];
    
    for (const m of markersData) {
      // ‚úÖ √âl√©ment du marqueur
      const el = document.createElement('div');
      el.className = 'custom-marker';
      el.style.backgroundImage = `url("${m.image}")`;
      el.style.width = '50px';
      el.style.height = '50px';
      el.style.backgroundSize = 'cover';
      el.style.borderRadius = '50%';
      el.style.border = '2px solid white';
      el.style.boxShadow = '0 0 4px rgba(0,0,0,0.5)';
    
      // ‚úÖ Contenu HTML de la popup
      const popupContent = `
      <div style="width: 220px;">
        <h4 style="margin: 0;">${m.title}</h4>
        <img src="${m.image}" alt="${m.title}" 
        style="
          width: 100%; 
          padding: 4px;
          background: white;
          border-radius: 4px; 
          margin: 5px 0; 
          box-sizing: border-box;
        ">
        <p style="margin: 0; font-size: 13px;">${m.description}</p>
        <p style="margin: 0; font-size: 13px;">${m.arrivee}</p>
        ${m.depart ? `<p style="margin: 0; font-size: 13px;">${m.depart}</p>` : ''}
      </div>
    `;
    
    el.addEventListener('click', () => {
  const sidebar = document.getElementById('sidebar-first');

  // Affiche photo1 s√©par√©ment
  const photo1Html = m.photo1 ? `<img src="${m.photo1}" alt="${m.title}" class="zoom-photo" style="width: 100%; border-radius: 10px; margin: 10px 0;">` : '';

  // G√©n√®re dynamiquement les autres photos (photo2 √† photo10)
  let otherPhotosHtml = '';
  for (let i = 2; i <= 10; i++) {
    const photoKey = `photo${i}`;
    if (m[photoKey]) {
      otherPhotosHtml += `<img src="${m[photoKey]}" alt="photo ${i}" class="zoom-photo" style="width: 100%; border-radius: 10px; margin: 10px 0;">`;
    }
  }

  // Affiche les infos dans la sidebar
  sidebar.innerHTML = `
    <h4 style="margin-top: 0;">${m.title}</h4>
    ${photo1Html}
    <p>${m.description}</p>
    ${m.arrivee ? `<p><strong>${m.arrivee}</strong></p>` : ''}
    ${m.depart ? `<p><strong>${m.depart}</strong></p>` : ''}
    ${m.commentaire ? `<p style="margin-top: 15px; font-style: italic; color: #555;">üìù ${m.commentaire}</p>` : ''}
    ${otherPhotosHtml}
  `;
});


    
      
      // ‚úÖ Ajoute le marqueur avec la popup
      new maplibregl.Marker({ element: el })
        .setLngLat(m.coords)
        .setPopup(new maplibregl.Popup({ offset: 25, closeButton: false }).setHTML(popupContent))
        .addTo(map);
          }
          
          // üîó Chemin entre les points
      const routeCoordinates = markersData.map(m => m.coords);
      
      map.addSource('itinerary', {
        type: 'geojson',
        data: {
          type: 'Feature',
          geometry: {
            type: 'LineString',
            coordinates: routeCoordinates
          }
        }
      });
      
      map.addLayer({
        id: 'itinerary-line',
        type: 'line',
        source: 'itinerary',
        layout: {
          'line-join': 'round',
          'line-cap': 'round'
        },
        paint: {
          'line-color': '#ff6600',
          'line-width': 4,
          'line-opacity': 0.8,
          'line-dasharray': [2, 4]
        }
      });


  });

  // Ces contr√¥les peuvent √™tre ajout√©s √† tout moment
  map.addControl(new maplibregl.FullscreenControl(), 'top-right');
  map.addControl(new maplibregl.NavigationControl({ visualizePitch: true }), 'top-left');
  map.addControl(new maplibregl.ScaleControl({ maxWidth: 150, unit: 'metric' }));
}

```

## Column {width="20%" .sidebar}


```{=html}
<div id="sidebar-first" style="width: 100%; margin-top: 20px; right: 20px; background: #b1c6dd; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); z-index: 1000; font-family: sans-serif;">
<div id="sidebar">
<div style="width: auto; padding:5px; border: 1px solid #A0A0A0; border-radius:15px; text-align: center !important; background: #F2F2F2; font-size:1.1em;margin-top:10%;">
Cette carte permet de visualiser les √©tapes de notre p√©riple mais aussi d'avoir les informations relatives √† nos visistes. 
</div>


  <div id="sidebar-content" style="color:#dc7633; text-align:center; font-size:1.3em; font-weight:bold; font-family: calibri;margin-bottom:10%;margin-top:20px;">
    Cliquez sur un marqueur pour voir les infos ici.
  </div>
</div>
</div>
```



